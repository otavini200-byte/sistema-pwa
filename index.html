<!DOCTYPE html>
<html lang="pt-BR">
<head>
<base target="_top">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sistema</title>

<style>
:root{
  --primary:#2c1a4d;
  --secondary:#6a4bc9;
  --bg:#f2f4f8;
  --card:#ffffff;
  --text:#333;
  --line:#d7d7d7;
  --shadow: rgba(0,0,0,.12);
}
.dark{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#f1f1f1;
  --line:#444;
  --shadow: rgba(0,0,0,.5);
}
*{ box-sizing:border-box; font-family:Segoe UI,Arial,sans-serif; }
body{ margin:0; background:var(--bg); color:var(--text); }
body.lock{ overflow:hidden; }
.hidden{display:none;}

.login{ min-height:100vh; display:flex; align-items:center; justify-content:center; }
.login-card{
  background:var(--card); padding:35px; width:380px; border-radius:14px;
  box-shadow:0 10px 30px var(--shadow);
}
.login-card h2{ text-align:center; margin-bottom:20px; }
.login-links{ text-align:center; margin-top:10px; font-size:13px; }
.login-links span{ cursor:pointer; color:var(--secondary); margin:0 5px; user-select:none; }

input,select,button{
  width:100%; padding:12px; margin-top:10px; border-radius:10px;
  border:1px solid var(--line); background:var(--card); color:var(--text);
}
button{ background:var(--primary); color:#fff; border:none; cursor:pointer; }

.small{ font-size:12px; opacity:.85; margin-top:10px; white-space:pre-wrap; }

.sistema{ display:flex; min-height:100vh; }
.sidebar{
  width:260px; background:linear-gradient(180deg,var(--primary),#1b0f30);
  color:#fff; padding:20px; position:relative;
}
.sidebar h3{ text-align:center; margin-bottom:20px; }
.menu div{
  padding:12px; margin-bottom:10px; background:rgba(255,255,255,.12);
  border-radius:10px; text-align:center; cursor:pointer; user-select:none;
}
.menu.inferior{ position:absolute; bottom:20px; width:220px; }

.conteudo{ flex:1; padding:30px; }
.box{
  background:var(--card); padding:25px; border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.08); max-width:1200px;
}
.tabela-container{
  border:1px solid var(--line); border-radius:12px; overflow:auto; min-height:260px;
}
.tabela-colagem{ width:100%; border-collapse:collapse; }
.tabela-colagem td{ border:1px solid var(--line); padding:7px; min-width:120px; }
.tabela-colagem td:focus{ outline:none; background:rgba(106,75,201,0.10); }

.row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
.row > *{ flex:1; min-width:160px; }
.btn-danger{ background:#c0392b; }
</style>
</head>

<body class="lock">

<!-- LOGIN -->
<div class="login" id="loginBox">
  <div class="login-card">
    <h2>ğŸ” Login</h2>
    <input id="usuario" placeholder="UsuÃ¡rio">
    <input id="senha" type="password" placeholder="Senha">
    <button onclick="entrar()">Entrar</button>

    <div class="login-links">
      <span onclick="mostrar('cadastro')">Criar conta</span> |
      <span onclick="mostrar('recuperar')">Recuperar senha</span> |
      <span onclick="toggleSenha()">ğŸ‘ Ver senha</span>
    </div>

    <div class="small" id="debugBox"></div>
  </div>
</div>

<!-- CADASTRO -->
<div class="login hidden" id="cadastro">
  <div class="login-card">
    <h2>Criar conta</h2>
    <input id="cUser" placeholder="UsuÃ¡rio">
    <input id="cSenha" placeholder="Senha">
    <input id="cEmail" placeholder="Email">
    <button onclick="cadastrar()">Cadastrar</button>
    <button onclick="mostrar('loginBox')">Voltar</button>
  </div>
</div>

<!-- RECUPERAR -->
<div class="login hidden" id="recuperar">
  <div class="login-card">
    <h2>Recuperar senha</h2>
    <input id="rUser" placeholder="UsuÃ¡rio">
    <button onclick="recuperarSenha()">Enviar email</button>
    <button onclick="mostrar('loginBox')">Voltar</button>
  </div>
</div>

<!-- SISTEMA -->
<div class="sistema hidden" id="sistema">
  <div class="sidebar">
    <h3>Sistema</h3>
    <div class="menu" id="menuPrincipal">
      <div onclick="abrir('transferencia')">ğŸ“¦ TransferÃªncia</div>
      <div onclick="abrir('zeramento')">ğŸ” Zeramento</div>
      <div onclick="abrir('requisicao')">ğŸ“ RequisiÃ§Ã£o</div>
    </div>
    <div class="menu inferior" id="menuInferior">
      <div onclick="sair()">ğŸšª Sair</div>
    </div>
  </div>

  <div class="conteudo">
    <div class="box hidden" id="transferencia">
      <h2>ğŸ“¦ TransferÃªncia</h2>
      <div class="tabela-container">
        <table class="tabela-colagem"><tbody></tbody></table>
      </div>
      <div class="row">
        <button onclick="alert('OK - TransferÃªncia')">ImportaÃ§Ã£o</button>
        <button class="btn-danger" onclick="criarTabela('transferencia')">Limpar</button>
      </div>
    </div>

    <div class="box hidden" id="zeramento">
      <h2>ğŸ” Zeramento</h2>
      <div class="tabela-container">
        <table class="tabela-colagem"><tbody></tbody></table>
      </div>
      <div class="row">
        <button onclick="alert('OK - Zeramento')">ImportaÃ§Ã£o</button>
        <button class="btn-danger" onclick="criarTabela('zeramento')">Limpar</button>
      </div>
    </div>

    <div class="box hidden" id="requisicao">
      <h2>ğŸ“ RequisiÃ§Ã£o</h2>
      <div class="tabela-container">
        <table class="tabela-colagem"><tbody></tbody></table>
      </div>
      <div class="row">
        <button onclick="alert('OK - RequisiÃ§Ã£o')">ImportaÃ§Ã£o</button>
        <button class="btn-danger" onclick="criarTabela('requisicao')">Limpar</button>
      </div>
    </div>
  </div>
</div>

<script>
/* COLE AQUI (com aspas e /exec) */
const API_URL = "https://script.google.com/macros/s/AKfycbw9QhuCIvuLHeEgtHUfIXHv7Cnj6CbGg2N9U8mt9JWkZbfauUhy2AZBxz25VGfN21r65Q/exec";

let NIVEL="", USUARIO_LOGADO="";
let PERMS={transferencia:"EDITAR",zeramento:"EDITAR",requisicao:"EDITAR"};
const COLS=9;

function $(id){return document.getElementById(id);}

function mostrar(id){
  document.querySelectorAll(".login").forEach(d=>d.classList.add("hidden"));
  $(id).classList.remove("hidden");
}

function toggleSenha(){
  const s=$("senha");
  s.type = (s.type==="password") ? "text" : "password";
}

function abrir(id){
  document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden"));
  const el=$(id);
  el.classList.remove("hidden");
}

function sair(){
  $("sistema").classList.add("hidden");
  $("loginBox").classList.remove("hidden");
  document.body.classList.add("lock");
  $("debugBox").textContent="";
  $("senha").value="";
}

/* API com DEBUG visual */
async function api(action,...args){
  const payload=JSON.stringify({action,args});
  const r=await fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"text/plain;charset=utf-8"},
    body:payload,
    redirect:"follow"
  });
  const txt=await r.text();
  if(!r.ok) throw new Error("HTTP "+r.status+" :: "+txt.slice(0,200));
  try{ return JSON.parse(txt); }
  catch(e){ throw new Error("Resposta nÃ£o-JSON: "+txt.slice(0,200)); }
}

/* Login (mostra debug e forÃ§a entrar) */
async function entrar(){
  const u=$("usuario").value.trim();
  const s=$("senha").value.trim();
  $("debugBox").textContent="";

  if(!API_URL || !API_URL.startsWith("http")){
    $("debugBox").textContent="ERRO: API_URL invÃ¡lida. Cole a URL /exec com aspas.";
    return;
  }

  try{
    const res=await api("login",u,s);

    $("debugBox").textContent =
      "Resposta API:\n" + JSON.stringify(res,null,2);

    if(res && res.ok){
      NIVEL=(res.nivel||"").toUpperCase();
      USUARIO_LOGADO=res.usuario||u;
      PERMS=res.perms||PERMS;

      document.body.classList.remove("lock");
      $("loginBox").classList.add("hidden");
      $("cadastro").classList.add("hidden");
      $("recuperar").classList.add("hidden");
      $("sistema").classList.remove("hidden");

      criarTabela("transferencia");
      criarTabela("zeramento");
      criarTabela("requisicao");

      abrir("transferencia");
    }else{
      alert(res.msg || "UsuÃ¡rio/senha invÃ¡lidos");
    }
  }catch(err){
    $("debugBox").textContent="ERRO:\n"+err.message;
    alert(err.message);
  }
}

async function cadastrar(){
  try{
    const r=await api("cadastrar",$("cUser").value,$("cSenha").value,$("cEmail").value);
    alert(r.ok ? "Conta criada!" : (r.msg||"Erro"));
    if(r.ok) mostrar("loginBox");
  }catch(e){ alert(e.message); }
}

async function recuperarSenha(){
  try{
    const r=await api("recuperar",$("rUser").value);
    alert(r.ok ? "Email enviado!" : (r.msg||"Erro"));
  }catch(e){ alert(e.message); }
}

/* tabela 9 colunas */
function criarTabela(boxId){
  const tbody=document.querySelector(`#${boxId} tbody`);
  tbody.innerHTML="";
  for(let i=0;i<10;i++){
    const tr=document.createElement("tr");
    for(let j=0;j<COLS;j++){
      const td=document.createElement("td");
      td.contentEditable="true";
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }
}

/* ENTER */
$("usuario").addEventListener("keyup",e=>{if(e.key==="Enter")entrar();});
$("senha").addEventListener("keyup",e=>{if(e.key==="Enter")entrar();});
</script>

</body>
</html>
