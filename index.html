<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sistema</title>

<style>
:root{
  --primary:#6a4bc9;
  --dark:#1f1b2e;
  --bg:#f4f5fb;
  --card:#ffffff;
  --text:#333;
}
*{box-sizing:border-box;font-family:Segoe UI,Arial}
body{margin:0;background:var(--bg);color:var(--text)}
.hidden{display:none}

/* LOGIN */
.login{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  width:380px;
  background:var(--card);
  padding:30px;
  border-radius:16px;
  box-shadow:0 15px 40px rgba(0,0,0,.15);
  animation:fade .4s ease;
}
@keyframes fade{from{opacity:0;transform:translateY(20px)}to{opacity:1}}
h2{text-align:center;margin-bottom:20px}

input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:10px;
}
button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  background:var(--primary);
  color:#fff;
  font-weight:bold;
  margin-top:14px;
  cursor:pointer;
}
button:hover{opacity:.9}

.links{
  text-align:center;
  margin-top:12px;
  font-size:13px;
}
.links span{
  cursor:pointer;
  color:var(--primary);
  margin:0 6px;
}

/* SISTEMA */
.app{display:flex;min-height:100vh}
.sidebar{
  width:240px;
  background:var(--dark);
  color:#fff;
  padding:20px;
}
.sidebar h3{text-align:center;margin-bottom:20px}
.sidebar div{
  padding:12px;
  border-radius:10px;
  margin-bottom:8px;
  cursor:pointer;
  background:rgba(255,255,255,.08);
}
.sidebar div:hover{background:rgba(255,255,255,.18)}

.content{
  flex:1;
  padding:30px;
}
.box{
  background:#fff;
  padding:20px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
}

/* TABELA */
table{
  width:100%;
  border-collapse:collapse;
}
td{
  border:1px solid #ccc;
  padding:6px;
  min-width:80px;
}
td:focus{outline:2px solid var(--primary)}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="loginBox">
  <div class="card">
    <h2>ğŸ” Login</h2>
    <input id="usuario" placeholder="UsuÃ¡rio">
    <input id="senha" type="password" placeholder="Senha">
    <button onclick="entrar()">Entrar</button>
    <div class="links">
      <span onclick="mostrarCadastro()">Criar conta</span> |
      <span onclick="toggleSenha()">ğŸ‘ Ver senha</span>
    </div>
  </div>
</div>

<!-- CADASTRO -->
<div class="login hidden" id="cadastroBox">
  <div class="card">
    <h2>ğŸ“ Cadastro</h2>
    <input id="cUser" placeholder="UsuÃ¡rio">
    <input id="cSenha" placeholder="Senha">
    <input id="cEmail" placeholder="Email">
    <button onclick="cadastrar()">Cadastrar</button>
    <button onclick="voltarLogin()">Voltar</button>
  </div>
</div>

<!-- SISTEMA -->
<div class="app hidden" id="app">
  <div class="sidebar">
    <h3>Sistema</h3>
    <div onclick="abrir('transfer')">ğŸ“¦ TransferÃªncia</div>
    <div onclick="abrir('zero')">ğŸ” Zeramento</div>
    <div onclick="abrir('req')">ğŸ“ RequisiÃ§Ã£o</div>
    <div onclick="sair()">ğŸšª Sair</div>
  </div>

  <div class="content">
    <div class="box hidden" id="transfer">
      <h2>ğŸ“¦ TransferÃªncia</h2>
      <table contenteditable="true"><tbody></tbody></table>
      <button onclick="importar('transfer')">ImportaÃ§Ã£o</button>
    </div>

    <div class="box hidden" id="zero">
      <h2>ğŸ” Zeramento</h2>
      <table contenteditable="true"><tbody></tbody></table>
      <button onclick="importar('zero')">ImportaÃ§Ã£o</button>
    </div>

    <div class="box hidden" id="req">
      <h2>ğŸ“ RequisiÃ§Ã£o</h2>
      <table contenteditable="true"><tbody></tbody></table>
      <button onclick="importar('req')">ImportaÃ§Ã£o</button>
    </div>
  </div>
</div>

<script>
/* ========= CONFIG ========= */
const API_URL = https://script.google.com/macros/s/AKfycbw9QhuCIvuLHeEgtHUfIXHv7Cnj6CbGg2N9U8mt9JWkZbfauUhy2AZBxz25VGfN21r65Q/exec;

/* ========= UTIL ========= */
function absNum(v){
  return Math.abs(parseFloat(String(v||"0").replace(",","."))||0);
}
function hoje(){
  const d=new Date();
  return d.toLocaleDateString("pt-BR");
}

/* ========= VISUAL ========= */
function toggleSenha(){
  senha.type = senha.type==="password"?"text":"password";
}
function mostrarCadastro(){
  loginBox.classList.add("hidden");
  cadastroBox.classList.remove("hidden");
}
function voltarLogin(){
  cadastroBox.classList.add("hidden");
  loginBox.classList.remove("hidden");
}
function abrir(id){
  document.querySelectorAll(".box").forEach(b=>b.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}
function sair(){
  app.classList.add("hidden");
  loginBox.classList.remove("hidden");
}

/* ========= API ========= */
async function api(action,...args){
  const r=await fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"text/plain;charset=utf-8"},
    body:JSON.stringify({action,args})
  });
  return r.json();
}

/* ========= LOGIN ========= */
async function entrar(){
  const res=await api("login",usuario.value,senha.value);
  if(!res.ok) return alert(res.msg||"Login invÃ¡lido");
  loginBox.classList.add("hidden");
  app.classList.remove("hidden");
}
async function cadastrar(){
  const r=await api("cadastrar",cUser.value,cSenha.value,cEmail.value);
  alert(r.ok?"Conta criada":r.msg);
  if(r.ok)voltarLogin();
}

/* ========= IMPORTAÃ‡ÃƒO (GENÃ‰RICA) ========= */
function importar(tipo){
  const tabela=document.querySelector(`#${tipo} table tbody`);
  const linhas=[...tabela.querySelectorAll("tr")];
  let out=[];
  for(const tr of linhas){
    const c=[...tr.cells].map(td=>td.innerText.trim());
    if(!c.length)continue;
    const qtd=absNum(c[c.length-1]);
    if(qtd===0)continue;
    out.push(`TESTE|${tipo}|${hoje()}|QTD:${qtd}`);
  }
  if(!out.length)return alert("Nada para importar");
  baixar(out.join("\n"),tipo);
}

/* ========= DOWNLOAD ========= */
function baixar(txt,nome){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([txt],{type:"text/plain"}));
  a.download=nome+".txt";
  a.click();
}

/* ENTER */
usuario.onkeyup=e=>e.key==="Enter"&&entrar();
senha.onkeyup=e=>e.key==="Enter"&&entrar();
</script>

</body>
</html>
